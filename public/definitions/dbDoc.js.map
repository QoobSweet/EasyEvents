{"version":3,"file":"dbDoc.js","sourceRoot":"","sources":["../../src/definitions/dbDoc.ts"],"names":[],"mappings":"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","sourcesContent":["import { AccessData, compressKey, decompressKey, Message, UserI } from \"./definitions\";\r\nimport { ServerApi } from \"../api/serverApi\";\r\n\r\n\r\nexport class DbDoc implements DbDoc {\r\n  [key: string]: AccessData | number | string | string[] | Function | Message[];\r\n  \r\n  identifierLabel = '';\r\n  collectionKey = '';\r\n  id = '';\r\n  lockedFields: string[] = [];\r\n\r\n  init = (user: UserI, serverApi: ServerApi, callback?: Function): void => {\r\n    console.log(\"Creating new \" + this.identifierLabel);\r\n    console.log(this);\r\n    if (this.id === '') {\r\n      console.log(\"pushing doc to database\");\r\n      serverApi.createDoc(user, this.collectionKey, this, (newId: string) => {\r\n        callback ? callback(newId) : null;\r\n      })\r\n    } else {\r\n      callback ? callback(this.id) : null;\r\n    }\r\n  }\r\n\r\n  toggleFieldLock = (key: string) => {\r\n    if (this.lockedFields) {\r\n      const i = this.lockedFields.indexOf(key);\r\n      if (i !== -1) {\r\n        this.lockedFields.splice(i, 1);\r\n      } else {\r\n        this.lockedFields.push(key);\r\n      }\r\n    } else {\r\n      this.lockedFields = [key];\r\n    }\r\n  }\r\n\r\n  accessField = (label: string, value: string | {}, type: AccessData[\"type\"], positionIndex: Number, selectionOptions?: string[] | null): AccessData => {\r\n    return {\r\n      label: label,\r\n      value: value,\r\n      type: type,\r\n      positionIndex: positionIndex,\r\n      options: selectionOptions ? selectionOptions : null\r\n    };\r\n  }\r\n\r\n  mergeModel(dataObj?: DbDoc) {\r\n      if (dataObj) {\r\n        for (const [key, value] of Object.entries(dataObj)) {\r\n          if (key !== 'serverApi') {\r\n            this[key] = value;\r\n          }\r\n        }\r\n      }\r\n  }\r\n\r\n  accessibleFields = (): AccessData[] => {\r\n    const buildObj: AccessData[] = [];\r\n    for (const [key, value] of Object.entries(this)) {\r\n      if ((value as AccessData).positionIndex) {\r\n        const accessData = value as AccessData;\r\n            //is AccessField\r\n          buildObj.push(this.accessField(decompressKey(key), accessData.value, accessData.type, accessData.positionIndex, accessData.options));\r\n        }\r\n    }\r\n    console.log(buildObj);\r\n    return buildObj;\r\n  }\r\n\r\n  updateField = (serverApi: ServerApi, key: string, value: unknown): void => {\r\n    console.log(\"updating Field \" + key + \" for \" + this.collectionKey);\r\n    if (this.id !== '') {\r\n        serverApi.setFieldValue(this.collectionKey, this.id, compressKey(key), value);\r\n    }\r\n  }\r\n\r\n  remove = (user: UserI, serverApi: ServerApi) => {\r\n      if (this.id !== '') {\r\n        if (window.confirm(\"Are You Sure You Would Like to Remove \" + this.identifierLabel + \"? \\n This cannot be undone!\")) {\r\n          serverApi.removeDoc(user, this.collectionKey, this.id);\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      } else {\r\n        throw new Error(\"Cannot remove \" + this.identifierLabel + \" as it has not been initialized yet.\");\r\n      }\r\n  }\r\n}"]}