{"version":3,"file":"form-wrapper.js","sourceRoot":"","sources":["../../../../src/components/form-wrapper/form-wrapper.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html } from 'lit';\r\nimport { customElement, property } from 'lit/decorators.js';\r\nimport '@material/mwc-textfield';\r\nimport '@material/mwc-icon';\r\nimport '@material/mwc-icon-button';\r\nimport '@material/mwc-select';\r\nimport '@material/mwc-list';\r\nimport '@material/mwc-list/mwc-list-item';\r\nimport { compressKey, decompressKey, FormItem, UserI } from '../../definitions/definitions';\r\nimport ServerApi from '../../api/serverApi';\r\nimport { DbDoc } from '../../definitions/dbDoc';\r\nimport { style } from './form-wrapper-css';\r\n\r\n@customElement('form-wrapper')\r\nexport class FormWrapper extends LitElement {\r\n  @property({ type: Object }) user: UserI | null = null;\r\n  @property({ type: Object }) docObject: DbDoc | null = null;\r\n  @property({ type: String }) title = '';\r\n  @property({ type: Number }) size = 20;\r\n  @property({ type: Boolean }) showDelete = false;\r\n  serverApi = ServerApi();\r\n\r\n  static styles = style;\r\n\r\n  getForm = (): FormItem[] => {\r\n    console.log(this.docObject);\r\n    const formItems: FormItem[] = [];\r\n\r\n    if (this.docObject) {\r\n      const fields = this.docObject.accessibleFields();\r\n      fields.forEach(field => {\r\n        formItems.push({\r\n          label: field.label,\r\n          data: field\r\n        });\r\n      })\r\n    }\r\n\r\n    console.log(formItems);\r\n    return formItems;\r\n  }\r\n\r\n  deleteForm = () => {\r\n    if (this.user && this.serverApi && this.docObject) {\r\n      this.docObject.remove(this.user, this.serverApi);\r\n    }\r\n  }\r\n\r\n  toggleFieldLock = (key: string) => {\r\n    console.log(\"toggling: \" + key);\r\n    if (this.user && this.docObject) {\r\n      if (this.docObject.lockedFields) {\r\n        const lockedFields = this.docObject.lockedFields;\r\n        const i = lockedFields.indexOf(key);\r\n        console.log(i);\r\n        console.log(this.docObject.lockedFields);\r\n\r\n        if (i !== -1) {\r\n          lockedFields.splice(i, 1);\r\n        } else {\r\n          lockedFields.push(key);\r\n        }\r\n        this.docObject.updateField(this.serverApi, 'lockedFields', lockedFields);\r\n      } else {\r\n        const lockedFields = [key];\r\n        this.docObject.updateField(this.serverApi, 'lockedFields', lockedFields);\r\n      }\r\n    }\r\n    this.requestUpdate();\r\n  }\r\n\r\n  updateField = (formItem: FormItem, event: Event) => {\r\n    if (this.user && this.docObject) {\r\n      const path = event.composedPath();\r\n      formItem.data.value = (path[0] as HTMLInputElement).value;\r\n      this.docObject.updateField(this.serverApi, formItem.label, formItem.data);\r\n    }\r\n    // do stuff with the value.\r\n  }\r\n  updateSelect = (formItem: FormItem, event: any) => {\r\n    if (this.user && this.docObject) {\r\n      if (event.detail.index && formItem.data.options) {\r\n        formItem.data.value = formItem.data.options[event.detail.index];\r\n        this.docObject.updateField(this.serverApi, formItem.label, formItem.data);\r\n      }\r\n    }\r\n  }\r\n\r\n  checkLocked = (key: string): Boolean => {\r\n    if (this.user && this.docObject) {\r\n      if (!this.docObject.lockedFields || this.docObject.lockedFields.indexOf(key.toString()) === -1) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  render() {\r\n    if (this.user && this.docObject) {\r\n      return html`\r\n        <div>\r\n          <div class=\"form-header\">\r\n            ${this.title ? html`<h2>${this.title}</h2>` : html``}\r\n            ${this.showDelete && this.serverApi && this.docObject\r\n              ? html`\r\n                <div class=\"button-collection-wrapper\">\r\n                  <div class=\"button-collection\">\r\n                    <div class=\"button-wrapper\">\r\n                      <mwc-icon-button class=\"delete-icon\" icon=\"delete_forever\" @click=\"${this.deleteForm}\"></mwc-icon-button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              `: html``}\r\n          </div>\r\n          <div class=\"form\">\r\n            ${this.getForm().map(formItem => {\r\n              if (formItem.data.type && formItem.data.type !== 'select' && formItem.data.type !== 'coorespondence') {\r\n                const key = compressKey(formItem.label);\r\n\r\n                //check for locked fields as they should be rendered, yet disabled\r\n                return this.checkLocked(key) ? html`\r\n                  <div class=\"field-wrapper\">\r\n                    <mwc-textfield\r\n                      @change=\"${(event: Event) => { this.updateField(formItem, event); }}\"\r\n                      size=\"${this.size}\"\r\n                      label=\"${formItem.data.label}\"\r\n                      value=\"${formItem.data.value}\"\r\n                      type=\"${formItem.data.type}\"\r\n                      icon=\"${formItem.data.type === 'date' ? \"event\" : \"\"}\"\r\n                      >\r\n                      <mwc-icon class=\"lock-field-button\">lock</mwc-icon>\r\n                    </mwc-textfield>\r\n                    <mwc-icon-button class=\"field-lock-button\" icon=\"lock\" @click=\"${() => this.toggleFieldLock(key)}\"></mwc-icon-button>\r\n                  </div>`\r\n                : html`\r\n                  <div class=\"field-wrapper\">\r\n                    <mwc-textfield\r\n                      size=\"${this.size}\"\r\n                      label=\"${formItem.data.label}\"\r\n                      value=\"${formItem.data.value}\"\r\n                      type=\"${formItem.data.type}\"\r\n                      icon=\"${formItem.data.type === 'date' ? \"event\" : \"\"}\"\r\n                      disabled\r\n                      >\r\n                      <mwc-icon class=\"lock-field-button\">lock_open</mwc-icon>\r\n                    </mwc-textfield>\r\n                    <mwc-icon-button class=\"field-lock-button\" icon=\"lock_open\" @click=\"${() => this.toggleFieldLock(key)}\"></mwc-icon-button>\r\n                  </div>`;\r\n              } else {\r\n                //is a selection **Selection fields cannot be locked as of now.\r\n                console.log(formItem);\r\n                if (!formItem.data.options) { throw new Error(\"cannot use selection field without also setting options parameter on accessfield.\"); }\r\n                return html`\r\n                  <mwc-select label=\"${formItem.data.label}\" @selected=\"${(event: any) => { this.updateSelect(formItem, event); }}\">\r\n                    ${formItem.data.options.map(option => { return formItem.data.value === option\r\n                      ? html`<mwc-list-item value=\"${option}\" selected>${decompressKey(option)}</mwc-list-item>`\r\n                      : html`<mwc-list-item value=\"${option}\">${decompressKey(option)}</mwc-list-item>`;\r\n                    })}\r\n                  </mwc-select>\r\n                `;\r\n              }\r\n            })}\r\n          </div>\r\n        </div>\r\n      `;\r\n    } else {\r\n      return html`Loading...`;\r\n    }\r\n  }\r\n}"]}