{"version":3,"file":"dbDoc.js","sourceRoot":"","sources":["../../../src/definitions/dbDoc.ts"],"names":[],"mappings":"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","sourcesContent":["import { AccessData, compressKey, decompressKey, Message, UserI } from \"./definitions\";\r\nimport { ServerApi } from \"../api/serverApi\";\r\n\r\n\r\nexport class DbDoc implements DbDoc {\r\n  [key: string]: AccessData | number | string | string[] | Function | Message[];\r\n  \r\n  identifierLabel = '';\r\n  collectionKey = '';\r\n  id = '';\r\n  lockedFields: string[] = [];\r\n\r\n  init = (user: UserI, serverApi: ServerApi, callback?: Function): void => {\r\n    console.log(\"Creating new \" + this.identifierLabel);\r\n    console.log(this);\r\n    if (this.id === '') {\r\n      console.log(\"pushing doc to database\");\r\n      serverApi.createDoc(user, this.collectionKey, this, (newId: string) => {\r\n        callback ? callback(newId) : null;\r\n      })\r\n    } else {\r\n      callback ? callback(this.id) : null;\r\n    }\r\n  }\r\n\r\n  toggleFieldLock = (key: string) => {\r\n    if (this.lockedFields) {\r\n      const i = this.lockedFields.indexOf(key);\r\n      if (i !== -1) {\r\n        this.lockedFields.splice(i, 1);\r\n      } else {\r\n        this.lockedFields.push(key);\r\n      }\r\n    } else {\r\n      this.lockedFields = [key];\r\n    }\r\n  }\r\n\r\n  accessField = (label: string, value: string | {}, type: AccessData[\"type\"], positionIndex: Number, selectionOptions?: string[] | null): AccessData => {\r\n    return {\r\n      label: label,\r\n      value: value,\r\n      type: type,\r\n      positionIndex: positionIndex,\r\n      options: selectionOptions ? selectionOptions : null\r\n    };\r\n  }\r\n\r\n  mergeModel(dataObj?: DbDoc) {\r\n      if (dataObj) {\r\n        for (const [key, value] of Object.entries(dataObj)) {\r\n          if (key !== 'serverApi') {\r\n            this[key] = value;\r\n          }\r\n        }\r\n      }\r\n  }\r\n\r\n  accessibleFields = (): AccessData[] => {\r\n    const buildObj: AccessData[] = [];\r\n    for (const [key, value] of Object.entries(this)) {\r\n      if ((value as AccessData).positionIndex) {\r\n        const accessData = value as AccessData;\r\n            //is AccessField\r\n          buildObj.push(this.accessField(decompressKey(key), accessData.value, accessData.type, accessData.positionIndex, accessData.options));\r\n        }\r\n    }\r\n    console.log(buildObj);\r\n    return buildObj;\r\n  }\r\n\r\n  updateField = (serverApi: ServerApi, key: string, value: unknown): void => {\r\n    console.log(\"updating Field \" + key + \" for \" + this.collectionKey);\r\n    if (this.id !== '') {\r\n        serverApi.setFieldValue(this.collectionKey, this.id, compressKey(key), value);\r\n    }\r\n  }\r\n\r\n  remove = (user: UserI, serverApi: ServerApi) => {\r\n      if (this.id !== '') {\r\n        if (window.confirm(\"Are You Sure You Would Like to Remove \" + this.identifierLabel + \"? \\n This cannot be undone!\")) {\r\n          serverApi.removeDoc(user, this.collectionKey, this.id);\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      } else {\r\n        throw new Error(\"Cannot remove \" + this.identifierLabel + \" as it has not been initialized yet.\");\r\n      }\r\n  }\r\n}"]}